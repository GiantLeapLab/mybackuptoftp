#!/bin/bash
# Create individual SQL files for each database. These files
# are imported automatically during an initial provision if
# the databases exist per the import-sql.sh process.


echo
echo "--- Start $0 $*"

set -o nounset
set -e 

CNT_PARAMS=6
if [[ $# -lt $CNT_PARAMS ]] ; then 
  echo "Error!!! Must be $CNT_PARAMS parameters"
  exit 1
fi

### Input parameters ###
PERIOD=$1
NOW=$2
DAY=$3
TYPE=$4
FNAME=$5
DIR_ROOT=$6

### FTP server Setup ###
FTPD='/GREY_1TB/ToolkitVault-server-backups'
FTPS='office.giantleaplab.com'
FTPU='tv-backuper'
FTPP='xn->52s4_dAHND#4'
FTP="$(which lftp)"

### Directories ###
DIR_BIN="${DIR_ROOT}/bin"
DIR_CFG="${DIR_ROOT}/cfg"
DIR_ARC="${DIR_ROOT}/arc"
DIR_LOG="${DIR_ROOT}/log"

FULLPATH="${FTPD}/${PERIOD}/${NOW}/${DAY}/${TYPE}"
echo "Copy to remote $FULLPATH/$FNAME.*"

#Start FTP backup using ncftp
$FTP -u $FTPU,$FTPP $FTPS<<EOF
mkdir -p "${FULLPATH}"
cd "${FULLPATH}"
lcd "$DIR_ARC"
mput -E -c "$FNAME.*"
quit
EOF
