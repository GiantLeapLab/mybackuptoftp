#!/bin/bash

set -o nounset
set -e 

echo '--- Start $0 ---'

### Input parameters ###
YEAR=$1
MONTH=$2
DAY=$3
WEEK=$4
DIR_ROOT=$5

### Prepare date and period information
PERIOD='daily'
if [[ "$WEEK" -eq 0 ]]; then
  PERIOD='weekly'
fi
if [[ "$DAY" -eq 1 ]]; then
  PERIOD='monthly'
fi
NOW="${YEAR}${MONTH}${DAY}"
echo "YEAR=${YEAR} MONTH=${MONTH} DAY=${DAY} WEEK=${WEEK} NOW=${NOW}"

### Directories ###
cd $DIR_ROOT
echo "DIR_ROOT: '${DIR_ROOT}' Current dir: '$(pwd)'"
DIR_BIN="${DIR_ROOT}/bin"
DIR_CFG="${DIR_ROOT}/cfg"
DIR_ARC="${DIR_ROOT}/arc"
DIR_LOG="${DIR_ROOT}/log"

#$DIR_BIN/prepare_remote $PERIOD

#do all backup script
SCRIPTS=' backup_db backup_data '
for SCRIPT in $SCRIPTS;
do 
  echo "Executing: $SCRIPT"
  echo $DIR_BIN/$SCRIPT $PERIOD $NOW $DIR_ROOT
  $DIR_BIN/$SCRIPT $PERIOD $NOW $DIR_ROOT
done

